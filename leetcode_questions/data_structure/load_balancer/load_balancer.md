# 负载均衡器

## 题目描述
实现一个负载均衡器，支持以下操作：
1. add(server_id)：添加一个服务器到负载均衡池
2. remove(server_id)：从负载均衡池中移除一个服务器
3. pick()：随机选择一个服务器

要求：所有操作的时间复杂度都是 O(1)

## 示例
```python
lb = LoadBalancer()
lb.add(1)
lb.add(2)
lb.add(3)
lb.pick()  # 随机返回1、2、3中的一个
lb.remove(1)
lb.pick()  # 随机返回2、3中的一个
```

## 解题思路

### 数据结构选择
1. **双向链表**
   - 维护服务器的顺序
   - 支持O(1)的插入和删除
   - 方便随机访问第k个节点

2. **哈希表**
   - 存储服务器ID到节点的映射
   - 支持O(1)的查找
   - 用于快速定位要删除的节点

### 实现细节

1. **添加服务器**
   - 检查服务器是否已存在
   - 创建新节点并添加到链表尾部
   - 更新哈希表映射

2. **移除服务器**
   - 通过哈希表找到节点
   - 从链表中删除节点
   - 更新哈希表

3. **随机选择**
   - 生成随机索引
   - 遍历链表到选中位置
   - 返回对应服务器ID

### 为什么使用双向链表？
1. O(1)时间删除节点
2. 维护服务器的顺序
3. 支持从任意位置插入/删除

### 复杂度分析
- 时间复杂度：O(1)
  - add：O(1)
  - remove：O(1)
  - pick：O(1)
- 空间复杂度：O(n)
  - n是服务器数量

## 代码实现要点
1. 使用虚拟头尾节点
2. 正确维护链表关系
3. 保持哈希表和链表的一致性
4. 处理边界情况

## 优化可能
1. 使用数组实现O(1)随机选择
2. 批量操作优化
3. 考虑并发访问
4. 添加负载均衡策略

## 与LRU缓存的比较
1. **相似点**
   - 都使用双向链表
   - 都需要O(1)的操作
   - 都使用哈希表加速查找

2. **不同点**
   - 负载均衡器需要随机访问
   - LRU需要维护访问顺序
   - 负载均衡器不需要容量限制 